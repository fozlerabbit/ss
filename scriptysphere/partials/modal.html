<div class="modal" id="generic-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-description">
    <div class="modal__overlay"></div>
    <div class="modal__container">
        <div class="modal__header">
            <h2 id="modal-title" class="modal__title"></h2>
            <button class="modal__close" aria-label="Close modal">
                <svg><use href="/assets/img/icons.svg#x"></use></svg>
            </button>
        </div>
        <div class="modal__body">
            <div id="modal-description" class="modal__content"></div>
        </div>
        <div class="modal__footer">
            <div class="modal__actions"></div>
        </div>
    </div>
</div>

<!-- Member Profile Modal -->
<div class="modal" id="member-modal" role="dialog" aria-modal="true" aria-labelledby="member-modal-title">
    <div class="modal__overlay"></div>
    <div class="modal__container modal__container--large">
        <div class="modal__header">
            <h2 id="member-modal-title" class="modal__title">Member Profile</h2>
            <button class="modal__close" aria-label="Close modal">
                <svg><use href="/assets/img/icons.svg#x"></use></svg>
            </button>
        </div>
        <div class="modal__body">
            <div class="member-profile">
                <div class="member-profile__avatar">
                    <img id="member-avatar" src="" alt="" loading="lazy">
                </div>
                <div class="member-profile__info">
                    <h3 id="member-name" class="member-profile__name"></h3>
                    <p id="member-role" class="member-profile__role"></p>
                    <p id="member-location" class="member-profile__location"></p>
                    <p id="member-id" class="member-profile__id"></p>
                    <div id="member-bio" class="member-profile__bio"></div>
                    <div id="member-skills" class="member-profile__skills"></div>
                    <div id="member-social" class="member-profile__social"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Video Modal -->
<div class="modal" id="video-modal" role="dialog" aria-modal="true" aria-labelledby="video-modal-title">
    <div class="modal__overlay"></div>
    <div class="modal__container modal__container--video">
        <div class="modal__header">
            <h2 id="video-modal-title" class="modal__title">Video</h2>
            <button class="modal__close" aria-label="Close modal">
                <svg><use href="/assets/img/icons.svg#x"></use></svg>
            </button>
        </div>
        <div class="modal__body">
            <div class="video-container">
                <iframe id="video-iframe" src="" frameborder="0" allowfullscreen></iframe>
            </div>
        </div>
    </div>
</div>

<script>
(function() {
    const modals = document.querySelectorAll('.modal');
    
    // Close modal function
    function closeModal(modal) {
        modal.classList.remove('modal--active');
        document.body.style.overflow = '';
        
        // Clear video if it's a video modal
        if (modal.id === 'video-modal') {
            const iframe = modal.querySelector('#video-iframe');
            iframe.src = '';
        }
    }
    
    // Open modal function
    function openModal(modalId, data = {}) {
        const modal = document.getElementById(modalId);
        if (!modal) return;
        
        modal.classList.add('modal--active');
        document.body.style.overflow = 'hidden';
        
        // Populate modal based on type
        if (modalId === 'member-modal' && data) {
            populateMemberModal(modal, data);
        } else if (modalId === 'video-modal' && data.videoUrl) {
            const iframe = modal.querySelector('#video-iframe');
            const title = modal.querySelector('#video-modal-title');
            iframe.src = data.videoUrl;
            title.textContent = data.title || 'Video';
        }
        
        // Focus first focusable element
        const focusable = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        if (focusable) {
            setTimeout(() => focusable.focus(), 100);
        }
    }
    
    function populateMemberModal(modal, member) {
        modal.querySelector('#member-avatar').src = member.avatar || '/assets/img/default-avatar.svg';
        modal.querySelector('#member-avatar').alt = member.name;
        modal.querySelector('#member-name').textContent = member.name;
        modal.querySelector('#member-role').textContent = member.role;
        modal.querySelector('#member-location').textContent = `${member.district}, ${member.division}`;
        modal.querySelector('#member-id').textContent = `ID: ${member.id}`;
        modal.querySelector('#member-bio').innerHTML = member.bio || '';
        
        // Skills
        const skillsContainer = modal.querySelector('#member-skills');
        skillsContainer.innerHTML = '';
        if (member.skills && member.skills.length > 0) {
            const skillsTitle = document.createElement('h4');
            skillsTitle.textContent = 'Skills';
            skillsContainer.appendChild(skillsTitle);
            
            const skillsList = document.createElement('div');
            skillsList.className = 'skills-list';
            member.skills.forEach(skill => {
                const skillTag = document.createElement('span');
                skillTag.className = 'skill-tag';
                skillTag.textContent = skill;
                skillsList.appendChild(skillTag);
            });
            skillsContainer.appendChild(skillsList);
        }
        
        // Social links
        const socialContainer = modal.querySelector('#member-social');
        socialContainer.innerHTML = '';
        if (member.social && Object.keys(member.social).length > 0) {
            const socialLinks = document.createElement('div');
            socialLinks.className = 'member-social-links';
            
            Object.entries(member.social).forEach(([platform, url]) => {
                if (url) {
                    const link = document.createElement('a');
                    link.href = url;
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                    link.setAttribute('aria-label', `${member.name} on ${platform}`);
                    link.innerHTML = `<svg><use href="/assets/img/icons.svg#${platform}"></use></svg>`;
                    socialLinks.appendChild(link);
                }
            });
            
            if (socialLinks.children.length > 0) {
                const socialTitle = document.createElement('h4');
                socialTitle.textContent = 'Connect';
                socialContainer.appendChild(socialTitle);
                socialContainer.appendChild(socialLinks);
            }
        }
    }
    
    // Global modal functions
    window.openModal = openModal;
    window.closeModal = closeModal;
    
    // Event listeners
    document.addEventListener('click', (e) => {
        // Close modal when clicking overlay or close button
        if (e.target.classList.contains('modal__overlay') || e.target.closest('.modal__close')) {
            const modal = e.target.closest('.modal');
            if (modal) closeModal(modal);
        }
    });
    
    // Close on escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            const activeModal = document.querySelector('.modal--active');
            if (activeModal) closeModal(activeModal);
        }
    });
})();
</script>